#!/bin/sh

if [ $RUN_WILDFLY_SERVER = "true" ]; then
    cp /opt/hummingbird/standalone-tests.xml /wildfly/standalone/configuration/standalone.xml
    exec /wildfly/bin/standalone.sh -DPIM_REF_DB_HOST=$PIM_REF_DB_HOST -DPIM_REF_DB_NAME=hummingbird_reference -DPIM_ROOT_DB=$PIM_ROOT_DB -DPIM_DB_PASSWORD=hummingbird -DPIM_REF_DB_PASSWORD=hummingbird -DPIM_DB_USER=hummingbird -DPIM_REF_DB_USER=hummingbird -DPIM_ADMIN_DB=$PIM_ADMIN_DB  -b 0.0.0.0 -bmanagement 0.0.0.0
else
cat <<EOF
This is an S2I WildFly v8.1 centos base image responsible for consuming a JEE project
and deploying it onto WildFly application server.
To use it, install S2I: https://github.com/openshift/source-to-image.

Sample invocation:

s2i build git://github.com/bparees/openshift-jee-sample openshift/wildfly-81-centos wildflytest

You can then run the resulting image via:
docker run -p 8080:8080 wildflytest

Details:
If a pom.xml is present in the source directory, the project is built with maven and the
output in target will be copied into the Wildfly deployments directory.
If war files are present in <src>/target or <src>/deployments they will be copied
into the Wildfly deployments directory as is.
Wildfly configuration can be overridden by supplying files in <src>/cfg, these files
will be copied into Wildfly standalone/configuration.
The default Maven build arguments can be overridden by setting MAVEN_ARGS via the "--env" argument to S2I
The default Maven build arguments can be appended by setting MAVEN_ARGS_APPEND.

If you run this image with environment variable RUN_WILDFLY_SERVER=true, this image will startup WF with ' /wildfly/bin/standalone.sh -b 0.0.0.0 -bmanagement 0.0.0.0 ' command
EOF
fi